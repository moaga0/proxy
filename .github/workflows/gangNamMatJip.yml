name: GangNamMatJip Crawl (Proxy)

on:
  workflow_dispatch:

jobs:
  crawl:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Prepare directories
        run: |
          mkdir -p output/html

      - name: Fetch Visit Pages (via Proxy)
        env:
          PROXY: 142.111.48.253:7030   # ðŸ‘‰ ì—¬ê¸° í”„ë¡ì‹œ êµì²´
        run: |
          echo "[INFO] Using proxy: $PROXY"

          for ca in 2005 2010 2015 2020 2025 2030 2035; do
            for page in 0 1 2; do
              url="https://xn--939au0g4vj8sq.net/theme/go/_list_cmp_tpl.php?ca=$ca&rpage=$page&row_num=28"
              out="output/html/${ca}_${page}.html"

              echo "[INFO] Fetching ca=$ca page=$page"

              curl -L \
                -x http://$PROXY \
                --connect-timeout 10 \
                --max-time 20 \
                -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 Chrome/120.0.0.0 Safari/537.36" \
                -H "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8" \
                -H "Accept-Language: ko-KR,ko;q=0.9,en-US;q=0.8" \
                -H "Connection: keep-alive" \
                "$url" \
                -o "$out" || true

              size=$(stat -c%s "$out" 2>/dev/null || echo 0)

              if [ "$size" -lt 1000 ]; then
                echo "[WARN] Failed ca=$ca page=$page (size=$size)"
                rm -f "$out"
              else
                echo "[OK] Saved ca=$ca page=$page (${size} bytes)"
              fi

              sleep 2
            done
          done

      - name: Zip HTML
        run: |
          zip -r gangnammatjip_html.zip output/html

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: gangnammatjip-html
          path: gangnammatjip_html.zip
