- name: Fetch Visit Pages
  run: |
    BASE_URL="https://xn--939au0g4vj8sq.net/theme/go/_list_cmp_tpl.php"
    mkdir -p output/html

    for ca in 2005 2010 2015 2020 2025 2030 2035; do
      for page in $(seq 0 60); do
        echo "[INFO] Fetching ca=$ca page=$page"

        curl -4 --http1.1 -L --compressed \
          --tlsv1.2 \
          --retry 3 --retry-delay 3 \
          --connect-timeout 15 \
          --max-time 40 \
          --no-keepalive \
          -A "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36" \
          -H "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8" \
          -H "Accept-Language: ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7" \
          -H "Referer: https://xn--939au0g4vj8sq.net/" \
          -H "Sec-Fetch-Dest: document" \
          -H "Sec-Fetch-Mode: navigate" \
          -H "Sec-Fetch-Site: same-origin" \
          -H "Upgrade-Insecure-Requests: 1" \
          "${BASE_URL}?ca=${ca}&rpage=${page}&row_num=28" \
          -o "output/html/${ca}_${page}.html"

        if [ ! -s "output/html/${ca}_${page}.html" ]; then
          echo "[WARN] Empty or failed ca=$ca page=$page"
          break
        fi

        SIZE=$(stat -c%s "output/html/${ca}_${page}.html")
        echo "[OK] Saved ca=$ca page=$page (${SIZE} bytes)"

        sleep 2
      done
    done
