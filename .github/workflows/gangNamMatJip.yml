name: GangNamMatJip Crawl

on:
  workflow_dispatch:

jobs:
  crawl:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Prepare directories
        run: |
          mkdir -p cache/visit
          mkdir -p cache/shipping

      - name: Fetch Visit HTML
        run: |
          for ca in 2005 2010 2015 2020 2025 2030 2035; do
            for page in 0 1 2 3 4 5; do
              echo "Visit ca=$ca page=$page"

              curl -L \
                --retry 5 \
                --retry-delay 3 \
                --connect-timeout 20 \
                --max-time 60 \
                -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)" \
                -H "Accept: text/html" \
                "https://xn--939au0g4vj8sq.net/theme/go/_list_cmp_tpl.php?ca=$ca&rpage=$page&row_num=28" \
                -o "cache/visit/${ca}_${page}.html" \
                || echo "<!-- failed ca=$ca page=$page -->" > "cache/visit/${ca}_${page}.html"

              sleep 2
            done
          done

      - name: Fetch Shipping HTML
        run: |
          for ca in 3005 3010 3015 3020 3030; do
            for page in 0 1 2 3 4 5; do
              echo "Shipping ca=$ca page=$page"

              curl -L \
                --retry 5 \
                --retry-delay 3 \
                --connect-timeout 20 \
                --max-time 60 \
                -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)" \
                -H "Accept: text/html" \
                "https://xn--939au0g4vj8sq.net/theme/go/_list_cmp_tpl.php?ca=$ca&rpage=$page&row_num=28" \
                -o "cache/shipping/${ca}_${page}.html" \
                || echo "<!-- failed ca=$ca page=$page -->" > "cache/shipping/${ca}_${page}.html"

              sleep 2
            done
          done

      - name: Zip result
        run: |
          zip -r gangnammatjip_html.zip cache

      - name: Upload zip artifact
        uses: actions/upload-artifact@v4
        with:
          name: gangnammatjip-html
          path: gangnammatjip_html.zip
