name: Fetch Visit Pages

on:
  workflow_dispatch:

jobs:
  fetch:
    runs-on: ubuntu-latest

    steps:
      - name: Fetch Visit Pages via Webshare Proxy
        env:
          PROXY_HOST: ${{ secrets.PROXY_HOST }}
          PROXY_PORT: ${{ secrets.PROXY_PORT }}
          PROXY_USER: ${{ secrets.PROXY_USER }}
          PROXY_PASS: ${{ secrets.PROXY_PASS }}
        run: |
          echo "▶ Start fetching with Webshare proxy"

          TARGET_URL="https://xn--939au0g4vj8sq.net"

          curl -v \
            -x http://${PROXY_USER}:${PROXY_PASS}@${PROXY_HOST}:${PROXY_PORT} \
            -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)" \
            -H "Accept: text/html,application/xhtml+xml" \
            --connect-timeout 20 \
            --max-time 30 \
            --retry 2 \
            --retry-delay 3 \
            "$TARGET_URL" \
            -o response.html

          echo "▶ Response saved"
          ls -lh response.html
