name: GangNamMatJip Crawl

on:
  workflow_dispatch:

jobs:
  crawl:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Prepare directories
        run: |
          mkdir -p output/html

      - name: Fetch Visit Pages
        run: |
          for ca in 2005 2010 2015 2020 2025 2030 2035; do
            for page in 0 1 2 3 4 5; do
              echo "[INFO] Fetching ca=$ca page=$page"
              curl -L --max-time 20 \
                -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)" \
                -H "Accept-Language: ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7" \
                "https://xn--939au0g4vj8sq.net/theme/go/_list_cmp_tpl.php?ca=$ca&rpage=$page&row_num=28" \
                -o "output/html/${ca}_${page}.html" \
                || echo "[WARN] Failed ca=$ca page=$page"
              sleep 1
            done
          done

      - name: Zip result
        run: |
          zip -r output_html.zip output

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: gangnammatjip-html
          path: output_html.zip
